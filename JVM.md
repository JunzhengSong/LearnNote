

# JVM

![](C:%5CUsers%5Csjz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20231021124819286.png)

## 	JVM内存结构

### Java内存区域

<img src="C:%5CUsers%5Csjz%5CDesktop%5CLearnNote%5Cassets%5Cjava-runtime-data-areas-jdk1.8.png" alt="java-runtime-data-areas-jdk1.8" style="zoom: 80%;" />



### 1. 程序计数器

字节码类似于汇编，字节码里是jvm指令

指令集是二进制的吗？

字节码需要解释器->机械码。

* 作用：记住下一条JVM指令执行的地址
* 特点： 
  * 线程私有
  * 不存在内存溢出

程序计数器线程私有，cpu中有那么多寄存器吗？



### 2. 虚拟机栈

#### 2.1 定义

* 每个**线程**运行所需要的内存，称为虚拟机栈
* 每个栈由多个栈帧组成，对应着每次方法调用占用的内存
* 每个线程都只能有一个活动栈帧，对应着当前正在执行的那个方法。（栈顶）

**问题：**

* 垃圾回收不涉及栈帧内存，方法调用结束就会被释放掉
* 栈内存可以通过 -Xss指定，是越大越好吗？内存大会导致线程数变少。
* 方法内的局部变量是否线程安全？
  * 如果局部变量引用了对象，则不安全
  * 如果局部变量没有逃离方法的作用访问，是安全的

#### 2.2 栈内存溢出

1. 栈帧过多导致内存溢出：递归过深
   	* 递归终止条件设置错误
   	* 调用第三方类库如对象转JSON，遇到对象循环引用无限递归，需要用注解将双向关联忽略一个改为单向关联
2. 栈帧过大导致内存溢出，少见



#### 2.3 线程运行诊断

1. CPU占用过高

   ​	定位：用







## QUESTIONS



static的共享范围是什么？需要考虑线程安全

传进来的参数是线程不安全的因为可能会有其他方法在使用这个对象？java不是值传递吗？方法处理的不是一个复制的值吗？值传递的值是引用，也就是对象的地址，对象是放在堆里的。



句柄



调用方法时分配一个栈帧，入栈之后，如果它调用其他方法，会再进入一个栈帧，类似于 递归

stack over flow就是递归过深， 栈是线程私有的吗？ 每个线程同时只能运行一个方法？  A B 两个没有先后关联关系的方法会分配给两个线程而不是一个吗？

![image-20231021182611436](C:%5CUsers%5Csjz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20231021182611436.png)





哪些在堆？ spring容器在堆吗？

### JMM和JVM的关系





### 





### Java到底是值传递还是引用传递？

**结论：Java没有指针这个概念，所以不存在引用传递**

Java数据类型分为基本数据类型和引用数据类型。

基本类型的内存分配在栈上完成。

引用类型包括类、接口、数组和null。

当我们定义一个对象并且使用 new 关键字来实例化对象时。

```java
User user = new User();
```

会经历如下三个步骤:

1、声明一个引用变量 user，在虚拟机栈上分配空间；

2、使用 new 关键字创建对象实例，在堆上分配空间存放对象内的属性信息；

3、将堆上的对象链接到 user 变量上，所以栈上存储的实际上就是存的对象在堆上的地址信息；

数组对象也是一样的，栈上只是存了一个地址，指向堆上实际分配的数组空间，实际的值是存在堆上的。



















传个list进去，必须得return接收才行吗？不能直接修改list的值吗？ 可以直接修改list的值



传个空list进去，在l方法里面add，外部的list会变吗？





在 Java 中，基本数据类型（如 int、float、char）是按值传递的，而对象是按引用传递的。然而，要注意理解：虽然引用是按值传递的，但这个值实际上是对象在内存中的地址。

<img src="C:%5CUsers%5Csjz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20231021195308928.png" alt="image-20231021195308928" style="zoom:50%;" />







### 一个java文件可以写多个class？





### 报错是谁报的？jvm吗？如果是jvm，他运行不是变成字节码之后才能运行吗，为什么还知道是哪行代码的问题呢？



### 代码是怎么变成一直运行着的程序的呢？

先跑main方法，一直运行着，然后到哪调哪？



Tomcat容器到底是做什么的？

Tomcat是web容器？但是如果没有前段的话，他是web 吗？后端也不是只限制在和前段沟通的吧？和postman这种非web沟通呢？还是说使用http网络请求的就是web？











